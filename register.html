<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <!--Bootstrap-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!--custom styles-->
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js" type="text/javascript"></script>
    <link href="fontawesome/css/all.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/header.css">
    <link rel="stylesheet" type="text/css" href="css/footer.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="js/validateform.js" type="text/javascript"></script>
    <script src="js/js-from.js" type="text/javascript"></script>
    <script src="js/host.js"></script>
    <script>
        var token = localStorage.getItem('token');
        if(token) {
            location.assign('home.html');
        }
    </script>

</head>

<body>
    <!-- HEADER TOP -->
    <div class="header-top">
        <div class="container2">
            <div class="row">
                <div class="col-md-4">
                    <ul class="right">
                        <li class="menu-item-border"><a class="item" href="#"><img src="images/flagen.webp"> English</a></li>
                        <li class="menu-item"><a class="item" href="#">$ USD</a></li>
                    </ul>
                </div>
                <div class="col-md-8 " >
                    <ul class="left" id="accountLogin">
                        
                    </ul>
                    <script>
                        var token = localStorage.getItem('token');
                        var userInfo = JSON.parse(localStorage.getItem('userInfo'));
                        // if (token) {
                        //     document.getElementById('accountLogin').innerHTML = `
                        //     <li class="menu-item-border">
                        //         <a class="item" href="cart.html"><i class="fas fa-list-alt"></i>Track your order</a>
                        //     </li>
                        //     <li class="menu-item-border">
                        //         <a class="item" href="profile.html#profile"><i class="fas fa-user"></i>${userInfo.userName.slice(0,8)}</a>
                        //     </li>
                        //     <li class="menu-item" >
                        //         <a class="item" onclick="logout()"><i class="fas fa-sign-in-alt" ></i></i>Log out</a>
                        //     </li>`
                        // }
                        // else {
                            document.getElementById('accountLogin').innerHTML = `
                            <li class="menu-item-border">
                                <a class="item" href="cart.html"><i class="fas fa-list-alt"></i>Track your order</a>
                            </li>
                            <li class="menu-item-border">
                                <a class="item" href="register.html#register"><i class="fas fa-user"></i>Create Account</a>
                            </li>
                            <li class="menu-item">
                                <a class="item" href="login.html#login"><i class="fas fa-sign-in-alt"></i></i>Login</a>
                            </li>`
                        //}
                    </script>
                    <script>
                        // function logout() {
                            
                        //     localStorage.removeItem('token');
                        //     localStorage.removeItem('userInfo');
                        //     document.getElementById('accountLogin').innerHTML = `
                        //     <li class="menu-item-border">
                        //         <a class="item" href="cart.html"><i class="fas fa-list-alt"></i>Track your order</a>
                        //     </li>
                        //     <li class="menu-item-border">
                        //         <a class="item" href="register.html#register"><i class="fas fa-user"></i>Create Account</a>
                        //     </li>
                        //     <li class="menu-item">
                        //         <a class="item" href="login.html#login"><i class="fas fa-sign-in-alt"></i></i>Login</a>
                        //     </li>`
                        //     location.replace('login.html#login')
                            
                        // }
                    </script>
                </div>
            </div>
        </div>
    </div>
    <!-- HEADER MIDDLE -->
    <div id="header-middle">

    </div>
    <script src="js/header_middle.js"></script>
    <!-- HEADER NAV -->
    <div id="header-nav">
        
    </div>
    <script src="js/header_nav.js"></script>
    <div class="register">
        <!--Title page-->
        <h1 id="register" class="title-head">REGISTER</h1>
        <!--Link to product-->
        
        <!--Main-->
        <div class="container">
            <div class="row" style="margin-bottom: 1rem">
                <div class="col-md-6 register-form">
                    <form action="localhost:3000/signup" id="formregister" method="POST">
                        <!--User name-->
                        <div class="form-group">
                            <label for="username">User name:</label> 
                            <input type="text" class="form-control"  placeholder="Enter your name" name="username" id="username" required>
                        </div>
                        
                        <!--Email-->
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" class="form-control"  placeholder="Enter email" name="email" id="email"required>
                        </div>
                        <!--Password-->
                        <div class="form-group">
                            <label for="pwd">Password:</label>
                            <input id="password" type="password" class="form-control"  placeholder="Enter password" name="password" id="password" required minlength="6">
                        </div>
                        <!--Confirm password -->
                        <div class="form-group">
                            <label>Confirm Password:</label>
                            <input type="password" class="form-control"  placeholder="Confirm your password" name="repassword" id="repassword" required>
                        </div>  
                        <!--Phone-->
                        <div class="form-group">
                            <label for="phone">Phone:</label>
                            <input type="tel" class="form-control"  placeholder="Enter your phone" name="phone" id="phone" required minlength="9">
                        </div>
                        <!--Address-->
                        <div class="form-group">
                            <label for="username">Address:</label> 
                            <input type="text" class="form-control"  placeholder="Enter your address" name="address" id="address" required maxlength="50">
                        </div>
                        <div class="submitbtn">
                            <button id="btn" class="submit" type="submit" class="btn btn-primary" onclick="handleSubmit()">Submit</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
    <!--Footer-->
    <div id="footer">
            
    </div>
    <script src="js/footer.js"></script>
    <script>
        function search(e) {
            if (e.keyCode == 13) {
                let text = e.target.value;
                console.log(text);
                if (!text)
                    return;
                text = text.trim();
                var keyword = {
                    name: text
                }
                localStorage.setItem('searchKey', text);
                e.target.value = '';
                location.assign('search.html');
            }
        }
    </script>
    <script>
        
        function handleSubmit() {
            var name = document.getElementById('username').value;
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;
            var phone = document.getElementById('phone').value;
            var address = document.getElementById('address').value;
            var confirmpw = document.getElementById('repassword').value;

            console.log(confirmpw)


            //Kiá»ƒm tra input true hay false
            var validName = document.getElementById('username').validity.valid;
            var validEmail = document.getElementById('email').validity.valid;
            var validPassword = document.getElementById('password').validity.valid;
            var validPhone = document.getElementById('phone').validity.valid;
            var validAddress = document.getElementById('address').validity.valid;
            var validConfirmpw = document.getElementById('repassword').validity.valid;
            
            if(isNaN(phone))
                validPhone = false;
            if(password === confirmpw)
                validConfirmpw = true;
            else
                validConfirmpw = false;
            var register = {    
                name: name,
                email: email,
                password: password,
                phone : phone,
                address : address,
                role : 'khachhang',

            }
            if(validName && validEmail && validPassword && validPhone && validAddress && validConfirmpw){
                axios.post(`${host}/signup`, register)
                .then((result) => {
                    console.log(result.data.message);
                    if (result.data.success) {
                        Swal.fire({
                            position: 'center',
                            icon: 'success',
                            title: 'Sign Up Success!',
                            showConfirmButton: false,
                            timer: 1200
                        })
                        setTimeout(function(){
                            location.replace('login.html#login');
                        }, 1200)
                        
                    }
                    else{
                        Swal.fire({
                        position: 'center',
                        icon: 'warning',
                        title: 'Registration Failed!!!',
                        text : 'Account already exists!',
                        showConfirmButton: false,
                        timer: 1200
                    })
                    }
                })
            }
            
        }


    </script>
</body>

</html>